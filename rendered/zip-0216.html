<!DOCTYPE html>
<html>
<head>
    <title>ZIP 216: Require Canonical Jubjub Point Encodings</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="css/style.css"></head>
<body>
    <section>
        <pre>ZIP: 216
Title: Require Canonical Jubjub Point Encodings
Owners: Jack Grigg &lt;jack@electriccoin.co&gt;
        Daira-Emma Hopwood &lt;daira-emma@electriccoin.co&gt;
Status: Final
Category: Consensus
Created: 2021-02-11
License: MIT
Discussions-To: &lt;<a href="https://github.com/zcash/zips/issues/400">https://github.com/zcash/zips/issues/400</a>&gt;</pre>
        <section id="terminology"><h2><span class="section-heading">Terminology</span><span class="section-anchor"> <a rel="bookmark" href="#terminology"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>The key word "MUST" in this document is to be interpreted as described in BCP 14 <a id="footnote-reference-1" class="footnote_reference" href="#bcp14">1</a> when, and only when, they appear in all capitals.</p>
            <p>The term "network upgrade" in this document is to be interpreted as described in ZIP 200. <a id="footnote-reference-2" class="footnote_reference" href="#zip-0200">21</a></p>
            <p>The terms "settled" and "full validator" in this document are to be interpreted as described in <a id="footnote-reference-3" class="footnote_reference" href="#protocol-blockchain">3</a>.</p>
            <p>The terms "Mainnet" and "Testnet" in this document are to be interpreted as described in <a id="footnote-reference-4" class="footnote_reference" href="#protocol-networks">4</a>.</p>
        </section>
        <section id="abstract"><h2><span class="section-heading">Abstract</span><span class="section-anchor"> <a rel="bookmark" href="#abstract"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>This ZIP fixes an oversight in the implementation of the Sapling consensus rules, by rejecting all non‑canonical representations of Jubjub points.</p>
        </section>
        <section id="motivation"><h2><span class="section-heading">Motivation</span><span class="section-anchor"> <a rel="bookmark" href="#motivation"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>The Sapling specification was originally written with the intent that all values, including Jubjub points, are strongly typed with canonical representations. <a id="footnote-reference-5" class="footnote_reference" href="#protocol-jubjub">11</a> This has significant advantages for security analysis, because it allows the protocol to be modelled with just the abstract types.</p>
            <p>The intention of the Jubjub implementation (both in the <cite>jubjub</cite> crate <a id="footnote-reference-6" class="footnote_reference" href="#jubjub-crate">26</a> and its prior implementations) was to ensure that only canonical point encodings would be accepted by the decoding logic. However, an oversight in the implementation allowed an edge case to slip through: for each point on the curve where the
                <span class="math">\(u\!\)</span>
            -coordinate is zero, there are two encodings that will be accepted:</p>
            <pre data-language="rust"><span class="c1">// Fix the sign of `u` if necessary</span>
<span class="kd">let</span><span class="w"> </span><span class="n">flip_sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Choice</span><span class="p">::</span><span class="n">from</span><span class="p">((</span><span class="n">u</span><span class="p">.</span><span class="n">to_bytes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">sign</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="n">u_negated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="n">final_u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fq</span><span class="p">::</span><span class="n">conditional_select</span><span class="p">(</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u_negated</span><span class="p">,</span><span class="w"> </span><span class="n">flip_sign</span><span class="p">);</span></pre>
            <p>This code accepts either sign bit, because <code>u_negated == u</code>.</p>
            <p>There are two points on the Jubjub curve with
                <span class="math">\(u\!\)</span>
            -coordinate zero:</p>
            <ul>
                <li>
                    <span class="math">\((0, 1)\!\)</span>
                , which is the identity;</li>
                <li>
                    <span class="math">\((0, -1)\!\)</span>
                , which is a point of order two.</li>
            </ul>
            <p>Each of these has a single non‑canonical encoding in which the value of the sign bit is
                <span class="math">\(1\!\)</span>
            .</p>
            <p>This creates a consensus issue because (unlike other non‑canonical point encodings that are rejected) either of the above encodings can be decoded, and then re-encoded to a <em>different</em> encoding. For example, if a non‑canonical encoding appeared in a transaction field, then node implementations that store points internally as abstract curve points, and used those to derive transaction IDs, would derive different IDs than nodes which store transactions as bytes (such as <cite>zcashd</cite>).</p>
            <p>This issue is not known to cause any security vulnerability, beyond the risk of consensus incompatibility. In fact, for some of the fields that would otherwise be affected, the issue does not occur because there are already consensus rules that prohibit small‑order points, and this incidentally prohibits non‑canonical encodings.</p>
            <p>Adjustments to the protocol specification were made in versions 2020.1.8, 2020.1.9, 2020.1.15, 2021.1.17, and 2023.4.0 to match the <cite>zcashd</cite> implementation. Further changes were also made in version 2025.6.0. The fact that this required six specification revisions to get right, conclusively demonstrates the problem.</p>
        </section>
        <section id="specification"><h2><span class="section-heading">Specification</span><span class="section-anchor"> <a rel="bookmark" href="#specification"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>Let
                <span class="math">\(\mathsf{abst}_{\mathbb{J}}\!\)</span>
            ,
                <span class="math">\(\mathsf{repr}_{\mathbb{J}}\!\)</span>
            , and
                <span class="math">\(q_{\mathbb{J}}\)</span>
             be as defined in <a id="footnote-reference-7" class="footnote_reference" href="#protocol-jubjub">11</a>.</p>
            <p>Define a non‑canonical compressed encoding of a Jubjub point to be a sequence of
                <span class="math">\(256\)</span>
             bits,
                <span class="math">\(b\!\)</span>
            , such that
                <span class="math">\(\mathsf{abst}_{\mathbb{J}}(b) \neq \bot\)</span>
             and
                <span class="math">\(\mathsf{repr_{\mathbb{J}}}\big(\mathsf{abst}_{\mathbb{J}}(b)\big) \neq b\!\)</span>
            .</p>
            <p>Non‑normative note: There are two such bit sequences,
                <span class="math">\(\mathsf{I2LEOSP}_{\ell_{\mathbb{J}}}(2^{255} + 1)\)</span>
             and
                <span class="math">\(\mathsf{I2LEOSP}_{\ell_{\mathbb{J}}}(2^{255} + q_{\mathbb{J}} - 1)\!\)</span>
            . The Sapling protocol uses little‑endian ordering when converting between bit and byte sequences, so the first of these sequences corresponds to a
                <span class="math">\(\mathtt{0x01}\)</span>
             byte, followed by
                <span class="math">\(30\)</span>
             zero bytes, and then a
                <span class="math">\(\mathtt{0x80}\)</span>
             byte.</p>
            <p>Once this ZIP activates, the following places within the Sapling consensus protocol where Jubjub points occur MUST reject non‑canonical Jubjub point encodings.</p>
            <p>In Sapling Spend descriptions <a id="footnote-reference-8" class="footnote_reference" href="#protocol-spenddesc">6</a>:</p>
            <blockquote>
                <ul>
                    <li>the
                        <span class="math">\(\underline{R}\)</span>
                     component (i.e. the first
                        <span class="math">\(32\)</span>
                     bytes) of the
                        <span class="math">\(\mathtt{spendAuthSig}\)</span>
                     RedDSA signature.</li>
                </ul>
            </blockquote>
            <p>In transactions <a id="footnote-reference-9" class="footnote_reference" href="#protocol-txnencoding">16</a>:</p>
            <blockquote>
                <ul>
                    <li>the
                        <span class="math">\(\underline{R}\)</span>
                     component (i.e. the first
                        <span class="math">\(32\)</span>
                     bytes) of the
                        <span class="math">\(\mathtt{bindingSigSapling}\)</span>
                     RedDSA signature.</li>
                </ul>
            </blockquote>
            <p>In the plaintext obtained by decrypting the
                <span class="math">\(\mathsf{C^{out}}\)</span>
             field of a Sapling transmitted note ciphertext (encrypted in <a id="footnote-reference-10" class="footnote_reference" href="#protocol-saplingandorchardencrypt">8</a> and decrypted in <a id="footnote-reference-11" class="footnote_reference" href="#protocol-decryptovk">10</a>):</p>
            <blockquote>
                <ul>
                    <li>
                        <span class="math">\(\mathsf{pk\star_d}\!\)</span>
                    .</li>
                </ul>
            </blockquote>
            <p>
                <span class="math">\(\mathsf{pk\star_d}\)</span>
             also MUST be considered invalid if it encodes the zero point
                <span class="math">\(\mathcal{O}_{\mathbb{J}}\!\)</span>
            .</p>
            <p>These requirements on
                <span class="math">\(\mathsf{pk\star_d}\)</span>
             affect the decryption of
                <span class="math">\(\mathsf{C^{out}}\)</span>
             in all cases, but are consensus-critical only in the case of decrypting
                <span class="math">\(\mathsf{C^{out}}\)</span>
             for a Sapling shielded coinbase output. <a id="footnote-reference-12" class="footnote_reference" href="#protocol-txnconsensus">17</a> <a id="footnote-reference-13" class="footnote_reference" href="#zip-0213">22</a></p>
            <p>Note: When a Sapling transmitted note ciphertext is decrypted using an incoming viewing key <a id="footnote-reference-14" class="footnote_reference" href="#protocol-decryptivk">9</a>,
                <span class="math">\(\mathsf{pk_d}\)</span>
             is computed as
                <span class="math">\(\mathsf{KA^{Sapling}.DerivePublic}(\mathsf{ivk}, \mathsf{g_d}) =\)</span>
                <span class="math">\([\mathsf{ivk}]\,\mathsf{g_d}\!\)</span>
            . Since
                <span class="math">\(\mathsf{g_d}\)</span>
             is an output of
                <span class="math">\(\mathsf{DiversifyHash^{Sapling}} \;{\small ⦂}\; \mathbb{B}^{[\ell_d]} \rightarrow \mathbb{J}^{(r)*} \cup \{\bot\}\!\)</span>
            , it cannot be
                <span class="math">\(\mathcal{O}_{\mathbb{J}}\!\)</span>
            .
                <span class="math">\(\mathsf{ivk}\)</span>
             cannot be
                <span class="math">\(0\)</span>
             for a validly constructed Sapling incoming viewing key <a id="footnote-reference-15" class="footnote_reference" href="#protocol-saplingkeycomponents">5</a>, and so the computed value of
                <span class="math">\(\mathsf{pk_d}\)</span>
             cannot be
                <span class="math">\(\mathcal{O}_{\mathbb{J}}\!\)</span>
            . An implementation MAY redundantly enforce that the computed value of
                <span class="math">\(\mathsf{pk_d}\)</span>
             is not
                <span class="math">\(\mathcal{O}_{\mathbb{J}}\!\)</span>
            .</p>
            <p>There are some additional fields in the consensus protocol that encode Jubjub points, but where non‑canonical encodings MUST already be rejected as a side effect of existing consensus rules.</p>
            <p>In Sapling Spend descriptions:</p>
            <blockquote>
                <ul>
                    <li>
                        <span class="math">\(\mathtt{cv}\)</span>
                    </li>
                    <li>
                        <span class="math">\(\mathtt{rk}\!\)</span>
                    .</li>
                </ul>
            </blockquote>
            <p>In Sapling Output descriptions <a id="footnote-reference-16" class="footnote_reference" href="#protocol-outputdesc">7</a>:</p>
            <blockquote>
                <ul>
                    <li>
                        <span class="math">\(\mathtt{cv}\)</span>
                    </li>
                    <li>
                        <span class="math">\(\mathtt{ephemeralKey}\!\)</span>
                    .</li>
                </ul>
            </blockquote>
            <p>These fields cannot by consensus contain small‑order points. All of the points with non‑canonical encodings are small‑order.</p>
            <p>Implementations MAY choose to reject non‑canonical encodings of the above four fields early in decoding of a transaction. This eliminates the risk that parts of the transaction could be re-serialized from their internal representation to a different byte sequence than in the original transaction, e.g. when calculating transaction IDs.</p>
            <p>In addition, Sapling addresses and full viewing keys MUST be considered invalid when imported if they contain non‑canonical Jubjub point encodings, or encodings of points that are not in the prime‑order subgroup
                <span class="math">\(\mathbb{J}^{(r)}\!\)</span>
            . These requirements MAY be enforced in advance of NU5 activation. This affects the fields listed below.</p>
            <p>In Sapling payment addresses <a id="footnote-reference-17" class="footnote_reference" href="#protocol-saplingpaymentaddrencoding">13</a>:</p>
            <blockquote>
                <ul>
                    <li>the encoding of
                        <span class="math">\(\mathsf{pk_d}\!\)</span>
                    .</li>
                </ul>
            </blockquote>
            <p>In Sapling full viewing keys <a id="footnote-reference-18" class="footnote_reference" href="#protocol-saplingfullviewingkeyencoding">15</a> and extended full viewing keys <a id="footnote-reference-19" class="footnote_reference" href="#zip-0032-extfvk">20</a>:</p>
            <blockquote>
                <ul>
                    <li>the encoding of
                        <span class="math">\(\mathsf{ak}\)</span>
                    </li>
                    <li>the encoding of
                        <span class="math">\(\mathsf{nk}\!\)</span>
                    .</li>
                </ul>
            </blockquote>
            <p>
                <span class="math">\(\mathsf{pk_d}\)</span>
             and
                <span class="math">\(\mathsf{ak}\)</span>
             also MUST be considered invalid if they encode the zero point
                <span class="math">\(\mathcal{O}_{\mathbb{J}}\!\)</span>
            .</p>
            <p>The fields mentioned in this Specification are intended to be a complete list of the places where compressed encodings of Jubjub points occur in the Zcash consensus protocol and in plaintext, address, or key formats.</p>
            <p>Note: Some versions of the Zcash protocol specification mistakenly allowed
                <span class="math">\(\mathsf{pk_d}\)</span>
             in a Sapling payment address, or
                <span class="math">\(\mathsf{pk\star_d}\)</span>
             in a decrypted
                <span class="math">\(\mathsf{C^{out}}\!\)</span>
            , to encode the zero point. The history is explained in a note added in version 2023.4.0 of the protocol specification <a id="footnote-reference-20" class="footnote_reference" href="#protocol-2023-4-0">18</a>:</p>
            <blockquote>
                <p>A previous version of this specification did not have the requirement for the decoded point
                    <span class="math">\(\mathsf{pk_d}\)</span>
                 of a Sapling note to be in the set of prime‑order points
                    <span class="math">\(\mathbb{J}^{(r)*}\)</span>
                 (i.e. "if ...
                    <span class="math">\(\mathsf{pk_d} \not\in \mathbb{J}^{(r)*}\!\)</span>
                , return
                    <span class="math">\(\bot\!\)</span>
                "). That did not match the implementation in <cite>zcashd</cite>. In fact the history is a little more complicated. The current specification matches the implementation in <cite>librustzcash</cite> as of <a id="footnote-reference-21" class="footnote_reference" href="#librustzcash-pr109">31</a>, which has been used in <cite>zcashd</cite> since v2.1.2. However, there was another implementation of Sapling note decryption used in <cite>zcashd</cite> for consensus checks, specifically the check that a shielded coinbase output decrypts successfully with the zero
                    <span class="math">\(\mathsf{ovk}\!\)</span>
                . This was corrected to enforce the same restriction on the decrypted
                    <span class="math">\(\mathsf{pk_d}\)</span>
                 in <cite>zcashd</cite> v5.5.0, originally set to activate in a soft fork at block height 2121200 on both Mainnet and Testnet <a id="footnote-reference-22" class="footnote_reference" href="#zcashd-pr6459">29</a>. (On Testnet this height was in the past as of the <cite>zcashd</cite> v5.5.0 release, and so the change would have been immediately enforced on upgrade.) Since the soft fork was observed to be retrospectively valid after that height, the implementation was simplified in <a id="footnote-reference-23" class="footnote_reference" href="#zcashd-pr6725">30</a> to use the <cite>librustzcash</cite> implementation in all cases, which reflects the specification above. <cite>zebra</cite> always used the <cite>librustzcash</cite> implementation.</p>
            </blockquote>
            <p>The protocol specification was further updated in version 2025.6.0 <a id="footnote-reference-24" class="footnote_reference" href="#protocol-2025-6-0">19</a>, to tighten the type of
                <span class="math">\(\mathsf{ivk}\)</span>
             in Sapling to
                <span class="math">\(\{ 1\,..\, 2^{\ell^{\mathsf{Sapling}}_{\mathsf{ivk}}}\!-1 \}\)</span>
             and the type of
                <span class="math">\(\mathsf{pk_d}\)</span>
             in both Sapling and Orchard to
                <span class="math">\(\mathsf{KA^{protocol}.PublicPrimeOrder}\!\)</span>
            , in order to make the exclusion of the zero point more obvious <a id="footnote-reference-25" class="footnote_reference" href="#zips-issue664">32</a>. This also has the effect that a Sapling incoming viewing key <a id="footnote-reference-26" class="footnote_reference" href="#protocol-saplinginviewingkeyencoding">14</a> or a Sapling IVK Encoding in a Unified Incoming Viewing Key <a id="footnote-reference-27" class="footnote_reference" href="#zip-0316">25</a> that encodes the zero
                <span class="math">\(\mathsf{ivk}\)</span>
             MUST be considered invalid when imported. Another note was also added explicitly covering the encoding of
                <span class="math">\(\mathsf{pk_d}\)</span>
             in Sapling payment addresses <a id="footnote-reference-28" class="footnote_reference" href="#protocol-saplingpaymentaddrencoding">13</a>:</p>
            <blockquote>
                <p>The restriction on
                    <span class="math">\(\mathsf{pk_d}\)</span>
                 reflects its current type
                    <span class="math">\(\mathsf{KA^{Sapling}.PublicPrimeOrder} = \mathbb{J}^{(r)*}\!\)</span>
                . In versions of this specification prior to 2025.6.0,
                    <span class="math">\(\mathsf{pk_d}\)</span>
                 had type
                    <span class="math">\(\mathsf{KA^{Sapling}.PublicPrimeSubgroup} = \mathbb{J}^{(r)}\!\)</span>
                , i.e. including
                    <span class="math">\(\mathcal{O}_{\mathbb{J}}\!\)</span>
                . Implementations of consumers for this encoding may need to be updated to exclude
                    <span class="math">\(\mathcal{O}_{\mathbb{J}}\!\)</span>
                , and should be checked for consistency with the current version of [ZIP-216].</p>
            </blockquote>
            <section id="retroactive-applicability"><h3><span class="section-heading">Retroactive applicability</span><span class="section-anchor"> <a rel="bookmark" href="#retroactive-applicability"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>As originally specified, this ZIP required that the new validity rules be applied only after NU5 activation. This was necessary because a transaction containing a non‑canonical Jubjub point encoding could have been included in any block before NU5 activation.</p>
                <p>However, now that NU5 is a settled upgrade on the Zcash Mainnet and Testnet chains <a id="footnote-reference-29" class="footnote_reference" href="#protocol-blockchain">3</a> <a id="footnote-reference-30" class="footnote_reference" href="#protocol-networks">4</a>, it can be observed that there were no such non‑canonical encodings in publically visible transaction fields before the Mainnet and Testnet NU5 activations. Therefore, a full validator MAY enforce the above specification retroactively.</p>
                <p>It remains possible that there could be non‑canonical
                    <span class="math">\(\mathsf{pk\star_d}\)</span>
                 encodings in plaintexts obtained by decrypting the
                    <span class="math">\(\mathsf{C^{out}}\)</span>
                 field of a Sapling transmitted note ciphertext. Such encodings MUST be rejected by the decryption procedure in <a id="footnote-reference-31" class="footnote_reference" href="#protocol-decryptovk">10</a> as currently specified. In version 2025.6.0 of the protocol specification <a id="footnote-reference-32" class="footnote_reference" href="#protocol-2025-6-0">19</a> this procedure has been changed to reject them unconditionally, not only after NU5 activation. (This has no effect on consensus relative to the previous version, because only small‑order Jubjub curve points have non‑canonical encodings, and so the check that returns
                    <span class="math">\(\bot\)</span>
                 if
                    <span class="math">\(\mathsf{pk_d} ∉ \mathbb{J}^{(r)*}\)</span>
                 would catch all such cases.)</p>
                <p>Rejecting non‑canonical
                    <span class="math">\(\mathsf{pk\star_d}\)</span>
                 encodings cannot lead to loss of funds sent to a Sapling address that has been correctly generated as specified in <a id="footnote-reference-33" class="footnote_reference" href="#protocol-saplingkeycomponents">5</a>, because such an address cannot have
                    <span class="math">\(\mathsf{ivk} = 0\!\)</span>
                , which is the only case in which
                    <span class="math">\(\mathsf{pk\star_d}\)</span>
                 could be non‑canonical. They are rejected in wallet rescanning by current <cite>zcashd</cite> and by <cite>librustzcash</cite>-based light wallets.</p>
                <p>Note: There are no such non‑canonical
                    <span class="math">\(\mathsf{pk\star_d}\)</span>
                 encodings in the
                    <span class="math">\(\mathsf{C^{out}}\)</span>
                 components of shielded coinbase outputs (which are required by consensus to be decryptable by an all-zero
                    <span class="math">\(\mathsf{ovk}\)</span>
                 <a id="footnote-reference-34" class="footnote_reference" href="#protocol-txnconsensus">17</a>).</p>
            </section>
        </section>
        <section id="rationale"><h2><span class="section-heading">Rationale</span><span class="section-anchor"> <a rel="bookmark" href="#rationale"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>Zcash previously had a similar issue with non‑canonical representations of points in Ed25519 public keys and signatures. In that case, given the prevalence of Ed25519 signatures in the wider ecosystem, the decision was made in ZIP 215 <a id="footnote-reference-35" class="footnote_reference" href="#zip-0215">23</a> (which activated with the Canopy network upgrade <a id="footnote-reference-36" class="footnote_reference" href="#zip-0251">24</a>) to allow non‑canonical representations of points.</p>
            <p>In Sapling, we are motivated instead to reject these non‑canonical points:</p>
            <ul>
                <li>The chance of the identity occurring anywhere within the Sapling components of transactions from implementations following the standard protocol is cryptographically negligible.</li>
                <li>This re-enables the aforementioned simpler security analysis of the Sapling protocol.</li>
                <li>The Jubjub curve has a vastly smaller scope of usage in the general cryptographic ecosystem than Curve25519 and Ed25519.</li>
            </ul>
            <p>The necessary checks are very simple and do not require cryptographic operations, therefore the performance impact will be negligible.</p>
            <p>The public inputs of Jubjub points to the Spend circuit (
                <span class="math">\(\!\mathsf{rk}\)</span>
             and
                <span class="math">\(\mathsf{cv^{old}}\!\)</span>
            ) and Output circuit (
                <span class="math">\(\!\mathsf{cv^{new}}\)</span>
             and
                <span class="math">\(\mathsf{epk}\!\)</span>
            ) are not affected because they are represented in affine coordinates as elements of the correct field (
                <span class="math">\(\!\mathbb{F}_{r_\mathbb{S}} = \mathbb{F}_{q_\mathbb{J}}\!\)</span>
            ), and so no issue of encoding canonicity arises.</p>
            <p>Encodings of elliptic curve points on Curve25519, BN‑254
                <span class="math">\(\mathbb{G}_1\!\)</span>
            , BN‑254
                <span class="math">\(\mathbb{G}_2\!\)</span>
            , BLS12‑381
                <span class="math">\(\mathbb{G}_1\!\)</span>
            , and BLS12‑381
                <span class="math">\(\mathbb{G}_2\)</span>
             are not affected.</p>
            <p>Encodings of elliptic curve points on the Pallas and Vesta curves <a id="footnote-reference-37" class="footnote_reference" href="#protocol-pallasandvesta">12</a> used by the Orchard shielded protocol are also not affected.</p>
        </section>
        <section id="security-and-privacy-considerations"><h2><span class="section-heading">Security and Privacy Considerations</span><span class="section-anchor"> <a rel="bookmark" href="#security-and-privacy-considerations"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>This ZIP eliminates a potential source of consensus divergence between differing full node implementations. From February 2023 onward, no known divergence of this type exists for any production implementation of Zcash, but an early alpha version of the <cite>zebrad</cite> node implementation would have been susceptible to this issue.</p>
        </section>
        <section id="deployment"><h2><span class="section-heading">Deployment</span><span class="section-anchor"> <a rel="bookmark" href="#deployment"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>This ZIP activated with Network Upgrade 5. Requirements on points encoded in payment addresses and full viewing keys MAY be enforced in advance of NU5 activation.</p>
            <p><cite>zcashd</cite> PRs #6000 <a id="footnote-reference-38" class="footnote_reference" href="#zcashd-pr6000">27</a>, #6399 <a id="footnote-reference-39" class="footnote_reference" href="#zcashd-pr6399">28</a>, #6459 <a id="footnote-reference-40" class="footnote_reference" href="#zcashd-pr6459">29</a>, and #6725 <a id="footnote-reference-41" class="footnote_reference" href="#zcashd-pr6725">30</a> retroactively enforce canonical encoding of Jubjub points for the entire chain history, as described in the <a href="#retroactive-applicability">Retroactive applicability</a> section.</p>
        </section>
        <section id="references"><h2><span class="section-heading">References</span><span class="section-anchor"> <a rel="bookmark" href="#references"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <table id="bcp14" class="footnote">
                <tbody>
                    <tr>
                        <th>1</th>
                        <td><a href="https://www.rfc-editor.org/info/bcp14">Information on BCP 14 — "RFC 2119: Key words for use in RFCs to Indicate Requirement Levels" and "RFC 8174: Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol" class="footnote">
                <tbody>
                    <tr>
                        <th>2</th>
                        <td><a href="protocol/protocol.pdf">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal] or later</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-blockchain" class="footnote">
                <tbody>
                    <tr>
                        <th>3</th>
                        <td><a href="protocol/protocol.pdf#blockchain">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 3.3: The Block Chain</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-networks" class="footnote">
                <tbody>
                    <tr>
                        <th>4</th>
                        <td><a href="protocol/protocol.pdf#networks">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 3.12: Mainnet and Testnet</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-saplingkeycomponents" class="footnote">
                <tbody>
                    <tr>
                        <th>5</th>
                        <td><a href="protocol/protocol.pdf#saplingkeycomponents">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 4.2.2: Sapling Key Components</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-spenddesc" class="footnote">
                <tbody>
                    <tr>
                        <th>6</th>
                        <td><a href="protocol/protocol.pdf#spenddesc">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 4.4: Spend Descriptions</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-outputdesc" class="footnote">
                <tbody>
                    <tr>
                        <th>7</th>
                        <td><a href="protocol/protocol.pdf#outputdesc">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 4.5: Output Descriptions</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-saplingandorchardencrypt" class="footnote">
                <tbody>
                    <tr>
                        <th>8</th>
                        <td><a href="protocol/protocol.pdf#saplingandorchardencrypt">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 4.20.1 Encryption (Sapling and Orchard)</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-decryptivk" class="footnote">
                <tbody>
                    <tr>
                        <th>9</th>
                        <td><a href="protocol/protocol.pdf#decryptivk">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 4.20.2 Decryption using a Incoming Viewing Key (Sapling and Orchard)</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-decryptovk" class="footnote">
                <tbody>
                    <tr>
                        <th>10</th>
                        <td><a href="protocol/protocol.pdf#decryptovk">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 4.20.3 Decryption using a Full Viewing Key (Sapling and Orchard)</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-jubjub" class="footnote">
                <tbody>
                    <tr>
                        <th>11</th>
                        <td><a href="protocol/protocol.pdf#jubjub">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 5.4.9.3: Jubjub</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-pallasandvesta" class="footnote">
                <tbody>
                    <tr>
                        <th>12</th>
                        <td><a href="protocol/protocol.pdf#pallasandvesta">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 5.4.9.6: Pallas and Vesta</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-saplingpaymentaddrencoding" class="footnote">
                <tbody>
                    <tr>
                        <th>13</th>
                        <td><a href="protocol/protocol.pdf#saplingpaymentaddrencoding">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 5.6.3.1: Sapling Payment Addresses</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-saplinginviewingkeyencoding" class="footnote">
                <tbody>
                    <tr>
                        <th>14</th>
                        <td><a href="protocol/protocol.pdf#saplinginviewingkeyencoding">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 5.6.3.2: Sapling Incoming Viewing Keys</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-saplingfullviewingkeyencoding" class="footnote">
                <tbody>
                    <tr>
                        <th>15</th>
                        <td><a href="protocol/protocol.pdf#saplingfullviewingkeyencoding">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 5.6.3.3: Sapling Full Viewing Keys</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-txnencoding" class="footnote">
                <tbody>
                    <tr>
                        <th>16</th>
                        <td><a href="protocol/protocol.pdf#txnencoding">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 7.1: Transaction Encoding and Consensus</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-txnconsensus" class="footnote">
                <tbody>
                    <tr>
                        <th>17</th>
                        <td><a href="protocol/protocol.pdf#txnconsensus">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 7.1.2: Transaction Consensus Rules</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-2023-4-0" class="footnote">
                <tbody>
                    <tr>
                        <th>18</th>
                        <td><a href="protocol/protocol.pdf#2023.4.0">Zcash Protocol Specification, Version 2023.4.0. Section 10: Change History — 2023.4.0</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-2025-6-0" class="footnote">
                <tbody>
                    <tr>
                        <th>19</th>
                        <td><a href="protocol/protocol.pdf#2025.6.0">Zcash Protocol Specification, Version 2025.6.0 [NU6.1 proposal]. Section 10: Change History — 2025.6.0</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0032-extfvk" class="footnote">
                <tbody>
                    <tr>
                        <th>20</th>
                        <td><a href="zip-0032#sapling-extended-full-viewing-keys">ZIP 32: Shielded Hierarchical Deterministic Wallets. Sapling extended full viewing keys</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0200" class="footnote">
                <tbody>
                    <tr>
                        <th>21</th>
                        <td><a href="zip-0200">ZIP 200: Network Upgrade Mechanism</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0213" class="footnote">
                <tbody>
                    <tr>
                        <th>22</th>
                        <td><a href="zip-0213">ZIP 213: Shielded Coinbase</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0215" class="footnote">
                <tbody>
                    <tr>
                        <th>23</th>
                        <td><a href="zip-0215">ZIP 215: Explicitly Defining and Modifying Ed25519 Validation Rules</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0251" class="footnote">
                <tbody>
                    <tr>
                        <th>24</th>
                        <td><a href="zip-0251">ZIP 251: Deployment of the Canopy Network Upgrade</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0316" class="footnote">
                <tbody>
                    <tr>
                        <th>25</th>
                        <td><a href="zip-0316">ZIP 316: Unified Addresses and Unified Viewing Keys</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="jubjub-crate" class="footnote">
                <tbody>
                    <tr>
                        <th>26</th>
                        <td><a href="https://github.com/zkcrypto/jubjub">jubjub Rust crate</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zcashd-pr6000" class="footnote">
                <tbody>
                    <tr>
                        <th>27</th>
                        <td><a href="https://github.com/zcash/zcash/pull/6000">zcash/zcash PR 6000: Enable ZIP 216 for blocks prior to NU5 activation</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zcashd-pr6399" class="footnote">
                <tbody>
                    <tr>
                        <th>28</th>
                        <td><a href="https://github.com/zcash/zcash/pull/6399">zcash/zcash PR 6399: Retroactively enable ZIP 216 before NU5 activation</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zcashd-pr6459" class="footnote">
                <tbody>
                    <tr>
                        <th>29</th>
                        <td><a href="https://github.com/zcash/zcash/pull/6459">zcash/zcash PR 6459: Migrate to zcash_primitives 0.10</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zcashd-pr6725" class="footnote">
                <tbody>
                    <tr>
                        <th>30</th>
                        <td><a href="https://github.com/zcash/zcash/pull/6725">zcash/zcash PR 6725: Retroactively use Rust to decrypt shielded coinbase before soft fork</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="librustzcash-pr109" class="footnote">
                <tbody>
                    <tr>
                        <th>31</th>
                        <td><a href="https://github.com/zcash/librustzcash/pull/109/files#diff-92d6b429f317a74bd65b2ad87d4f841e9fa9e334edab4199cdaba91172cd2d10R147-R151">zcash/librustzcash PR 109: PaymentAddress encapsulation</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zips-issue664" class="footnote">
                <tbody>
                    <tr>
                        <th>32</th>
                        <td><a href="https://github.com/zcash/zips/issues/664">zcash/zips issue 664: Sapling pk_d should not allow the zero point</a></td>
                    </tr>
                </tbody>
            </table>
        </section>
    </section>
</body>
</html>