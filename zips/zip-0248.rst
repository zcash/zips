::

  ZIP: 248
  Title: Extensible Transaction Format
  Owners: Jack Grigg <jack@znewco.com>
          Kris Nuttycombe <kris@nutty.land>
          Daira-Emma Hopwood <daira@jacaranda.org>
          Schell Scivally <efsubenovex@gmail.com>
  Status: Draft
  Category: Consensus / Wallet
  Created: 2025-12-17
  License: MIT
  Discussions-To: <https://github.com/zcash/zips/pull/1163>
  Pull-Request: <https://github.com/zcash/zips/pull/1156>

Terminology
===========

{Edit this to reflect the key words that are actually used.}
The key words "MUST", "REQUIRED", "MUST NOT", "SHOULD", and "MAY" in this
document are to be interpreted as described in BCP 14 [^BCP14] when, and only
when, they appear in all capitals.

The character § is used when referring to sections of the Zcash Protocol
Specification. [#protocol]_

The terms "Mainnet" and "Testnet" are to be interpreted as described in § 3.12
‘Mainnet and Testnet’. [#protocol-networks]_

The term "full validator" in this document is to be interpreted as defined in §
3.3 ‘The Block Chain’. [#protocol-blockchain]_

The terms below are to be interpreted as follows:

transparent transaction value pool
  An ephemeral value for the balance of an asset within the scope of a single
  transaction, which is modified by additions and subtractions in the
  processing of the effects of transaction bundles. When all of the effects of
  a transaction are accounted for, each such balance is zero; i.e, the total of
  additions to the balance equals the total of subtractions from it.


Abstract
========

This ZIP proposes an encoding for V6 Zcash transactions that is intended to
reduce the impact of future changes to the Zcash transaction format on the
Zcash ecosystem. It defines a new typecode-length-value encoding for a sequence
of protocol bundles, and a "value balance" map that describes the effect of
each bundle on the transparent transaction value pool for each asset. The
entries of this map serve the same purpose as the Sapling and Orchard value
balance fields have done in the past.


Motivation
==========

In the past, Zcash network upgrades that changed the transaction format have
resulted in substantial disruption for wallets and other third-party clients in
the Zcash ecosystem. In order to continue functioning after a network upgrade,
clients were required to upgrade their Zcash transaction parsers to read the
new format, even if the context in which those parsers were being used didn't
need or couldn't make use of newly added transaction data. An example of this
is that transparent-only wallets were forced to update their parsers to
understand the Sapling and Orchard parts of transactions, even if they would
never read or act upon those parts. This has led on occasion to significant
problems in the Zcash ecosystem, including situations where funds have been
locked and rendered unspendable from transparent-only wallets.

For some kinds of changes to consensus features, it's imperative that every
wallet be aware of and be adapted to those changes, and in those cases making a
major (breaking) transaction version update as we've done in the past is
appropriate. For many new features, however, it is possible for a wallet to
continue functioning correctly without having to fully understand a transaction
using that feature.

For example, if TZEs were to be added to the protocol, it wouild be possible
for wallets to continue operating with transparent/Sapling/Orchard
functionality, ignoring TZE parts. There is substantial precedent for this sort
of behavior; transparent-only hardware wallets are currently still important in
the Zcash ecosystem, and many wallets didn't begin interacting with Orchard
transaction parts until quite a while after Orchard activation.

After this change to transaction encoding, wallets and other third parties will
not be required to update their transaction parsers in advance of a network
upgrade for the introduction of many (and perhaps most) types of new protocol
features. This will enable the Zcash ecosystem to make smaller and more
incremental network upgrades without breaking existing wallets.


Privacy Implications
====================

This change alters the encoding of transactions, but does not alter the
information content of the transaction. As such, the only implication of this
change is that the use of this transaction format acts as a 1-bit distinguisher
that reveals that the wallet that generated the transaction has been updated to
be aware of the new format. This information leakage is unavoidable for any
transaction format change.

In the future, this change may reduce the amount of information leakage, since
transactions created using the proposed TLV format will include bundles only
for those protocols for which the transaction modifies chain state. For example,
if this transaction format change is deployed in NU7 and NU8 defines a bundle
type for TZE components, it will not be possible for a chain observer to
distinguish whether or not the wallet that produced an Orchard-only transaction
is one that has been updated to understand the TZE component. Under prior
practices for changing the transaction format, this would have been
distinguishable.

In summary, this proposal provides a net improvement in user privacy in
addition to its other benefits.


Requirements
============

* The transaction format can be parsed without any knowledge of any Zcash
  payment protocols.
* Movement of value into and out of the transparent value pools (the ZEC
  transparent value pool, plus the transparent value pool for each ZSA asset)
  can be understood with only partial knowledge of the Zcash payment protocols.
* The information content of transactions should not change as part of
  this ZIP. Other ZIPs activated along with this ZIP may however make
  use of it in introducing such changes.
* It must be possible for wallets to parse any transaction that is valid within
  a version group that it understands, even if it doesn't have handling for or
  understand all of the bundle types that are valid for that version group. In
  such a situation, however, such a wallet must still be able to accurately
  describe any transparent movement of funds effected by the transaction, and
  alert the user if the transaction contains bundles that it does not
  understand.
* It must be possible for a wallet to correctly construct and sign transactions
  for a given transaction version group that it understands, even if it doesn't
  have handling for or understand all of the bundle types that are valid for
  transactions in that version group.


Non-requirements
================


Specification
=============

Transaction Format
------------------

+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| Bytes                       | Name                         | Data Type                                      | Description                                                         |
+=============================+==============================+================================================+=====================================================================+
| **Common Transaction Fields**                                                                                                                                                     |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| 4                           |``header``                    |``uint32``                                      |Contains:                                                            |
|                             |                              |                                                |                                                                     |
|                             |                              |                                                |* ``fOverwintered`` flag (bit 31, always set)                        |
|                             |                              |                                                |* ``version`` (bits 30 .. 0) – transaction version.                  |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| 4                           |``nVersionGroupId``           |``uint32``                                      |Version group ID (nonzero).                                          |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| 4                           |``nConsensusBranchId``        |``uint32``                                      |Consensus branch ID (nonzero).                                       |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| 4                           |``lock_time``                 |``uint32``                                      |Unix-epoch UTC time or block height, encoded as in Bitcoin.          |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| 4                           |``nExpiryHeight``             |``uint32``                                      |A block height in the range {1 .. 499999999} after which             |
|                             |                              |                                                |the transaction will expire, or 0 to disable expiry. [#zip-0203]_    |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| **Transaction transparent value pool balance map**                                                                                                                                |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| varies                      |``nValuePoolDeltas``          |``compactSize``                                 |Number of entries in the ``mValuePoolDeltas`` map.                   |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| varies                      |``mValuePoolDeltas``          |``ValuePoolDelta[nValuePoolDeltas]``            |A map describing the change to the transparent value pool produced by|
|                             |                              |                                                |each bundle. Only bundles that produces changes to the transparent   |
|                             |                              |                                                |value balance will have corresponding entries in this map. For       |
|                             |                              |                                                |bundles that have no data except for a value, such as the ZIP 233    |
|                             |                              |                                                |amount, no additional bundle data will be present in the ``Bundles`` |
|                             |                              |                                                |section.                                                             |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| **Bundles**                                                                                                                                                                       |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| varies                      |``nBundles``                  |``compactSize``                                 |Number of bundles in the transaction that have per-bundle data.      |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| varies                      |``vBundles``                  |``Bundle[nBundles]``                            |A sequence of ``Bundle`` values.                                     |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+

ValuePoolDelta
--------------

+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| Bytes                       | Name                         | Data Type                                      | Description                                                         |
+=============================+==============================+================================================+=====================================================================+
| varies                      |``bundleType``                |``compactSize``                                 |An encoding of the bundle type identifier.                           |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| 1                           |``assetClass``                |``uint8``                                       |An asset class identifier. 0x00 for the ZEC asset, 0x01 for ZSA      |
|                             |                              |                                                |assets. All other values are reserved for future use.                |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| one of {0, 32}              |``assetId``                   |``byte[0] or byte[32]``                         |If `assetClass == 0`, the zero-length byte array, otherwise a byte   |
|                             |                              |                                                |array containing the 32-byte asset ID for the asset.                 |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| 8                           |``value``                     |``nonzero int64``                               |The net change to the transparent value pool of the given asset      |
|                             |                              |                                                |produced by the bundle corresponding to the bundle type identifier.  |
|                             |                              |                                                |This value MUST be nonzero; if a ``ValuePoolDelta`` record would     |
|                             |                              |                                                |have zero value, it MUST be elided from the encoding                 |
|                             |                              |                                                |of ``mValuePoolDeltas`` instead.                                     |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+

In definitions below, $[0]^{32}$ is treated as the asset identifier for the ZEC asset.

.. math::

    \mathsf{AssetId} =
    \begin{cases}
       [0]^{32} & \text{if } \mathsf{assetClass} = 0 \\
       \mathsf{assetId} & \text{otherwise}
    \end{cases}

``mValuePoolDeltas`` is interpreted as a map keyed by the tuple
$(\mathsf{BundleType}, \mathsf{AssetId})$. The map MUST NOT contain more than
a single entry for a given key.

Bundle
------

+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| Bytes                       | Name                         | Data Type                                      | Description                                                         |
+=============================+==============================+================================================+=====================================================================+
| varies                      |``bundleType``                |``compactSize``                                 |An encoding of the bundle type identifier.                           |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| varies                      |``nBundleEffectsLen``         |``compactSize``                                 |The length of the ``vBundleEffectsData`` byte array.                 |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| varies                      |``vBundleEffectsData``        |``byte[nBundleEffectsLen]``                     |The "effecting" data for the bundle. This consists of any            |
|                             |                              |                                                |information in the bundle that induces a state change in the         |
|                             |                              |                                                |blockchain and must therefore be committed to by the txid.           |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| varies                      |``nBundleAuthLen``            |``compactSize``                                 |The length of the ``vBundleAuthData`` byte array.                    |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+
| varies                      |``vBundleAuthData``           |``byte[nBundleAuthLen]``                        |The authorizing data for the bundle.                                 |
+-----------------------------+------------------------------+------------------------------------------------+---------------------------------------------------------------------+


Bundle type identifier ID Registry
----------------------------------

The following integers are registered as bundle type identifiers for the V6
transaction format. All currently-defined IDs are encoded as single-byte
``CompactSize`` values where they appear in the transaction format.

The "Can appear in ``mValuePoolDeltas``" column indicates whether or not an
entry for this value type is allowed to appear in ``mValuePoolDeltas``. For
rows where an ❌ is present, the value pool delta for every pool is guaranteed
to be zero, and so entries in ``mValuePoolDeltas`` are disallowed.

The "Can appear in ``vBundles``" column indicates whether or not an entry for
this value type is allowed to appear in ``vBundles``. For rows where an ❌ is
present, the bundle is guaranteed to have no effecting or authorizing data, and
so no entry in ``vBundles`` is permitted.

+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
| BundleType | Can appear in ``mValuePoolDeltas`` | Can appear in ``vBundles`` | Bundle kind                                                 |
+============+====================================+============================+=============================================================+
| 0          |✅                                  |✅                          | Transparent                                                 |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
| 1          |✅                                  |✅                          | Reserved                                                    |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
| 2          |✅                                  |✅                          | Sapling                                                     |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
| 3          |✅                                  |✅                          | Orchard                                                     |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
| 4\*        |✅                                  |❌                          | Transaction fee (\*if ZIP 2002 activated)                   |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
| 5\*        |✅                                  |❌                          | ZIP 233 NSM field (\*if ZIP 233 activated)                  |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
| 6\*        |❌                                  |✅                          | ZIP 270 Key rotation (\*if ZIP 270 activated)               |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
| 7\*        |✅                                  |✅                          | Lockbox disbursement / "Consensus accounts"                 |
|            |                                    |                            | (\*for miner payouts, lockbox, etc if ZIP activated)        |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |❌                                  |✅                          | ZIP 231 Memos                                               |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |✅                                  |✅                          | Sapling-post-ZIP 231 (if ZIP 231 activated after this ZIP)  |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |✅                                  |✅                          | Orchard-post-ZIP 231 (if ZIP 231 activated after this ZIP)  |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |✅                                  |✅                          | ZSA Issuance                                                |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |✅                                  |✅                          | OrchardZSA                                                  |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+

The following entries are provided to illustrate how potential future upgrades
might affect the value pool delta map.

+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
| BundleType | Can appear in ``mValuePoolDeltas`` | Can appear in ``vBundles`` | Bundle kind                                                 |
+============+====================================+============================+=============================================================+
|            |✅                                  |✅                          | TZEs                                                        |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |✅                                  |✅                          | Pool that only has a long-term storage protocol (PQ, very   |
|            |                                    |                            | simple thus insulated from counterfeiting fears, can be     |
|            |                                    |                            | used for payments but higher latency for that purpose)      |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |✅                                  |✅                          | Tachyon                                                     |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |✅                                  |✅                          | Staking                                                     |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |✅                                  |✅                          | Unstaking (if it can't be combined with the Staking bundle) |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+
|            |✅                                  |✅                          | Post-quantum fast payment protocol                          |
+------------+------------------------------------+----------------------------+-------------------------------------------------------------+

Consensus Rules
---------------

Full node implementations MUST verify that:

* The ``assetClass`` value for any entry in ``mValuePoolDeltas`` having
  ``bundleType = 4`` (fees) is 0 (fee amounts are denominated in ZEC
  and no other asset.)

* For the coinbase transaction, the sum of value pool deltas in the ZEC asset
  is equal to the negative of the block subsidy for that block; the block
  subsidy adds an implicit input value to the transparent transaction value
  pool that the coinbase outputs consume. 

.. math::

    \sum_{\mathsf{d} \in \mathsf{mValuePoolDeltas} | \mathsf{d}.\mathsf{bundleType} = 4} \mathsf{d.value} = \mathsf{BlockSubsidy}(\mathsf{height})

* For the coinbase transaction, the value of the fee bundle is equal to the
  negative of the total fees produced by the non-coinbase transactions in the
  block. $\mathsf{T}$ is the set of non-coinbase transactions included in the
  block. 

.. math::

    \mathsf{mValuePoolDeltas}[(4, [0]^{32})].\mathsf{value} = -\sum_{\mathsf{t} \in \mathsf{T}}\mathsf{mValuePoolDeltas}_{\mathsf{t}}[(4, [0]^{32})].\mathsf{value}

* For all non-coinbase transactions, the sum of value pool delta values in each
  asset equals 0. 

.. math::

    \forall bundleType,assetId. \sum\mathsf{mValuePoolDeltas}[(bundleType, assetId)].\mathsf{value} = 0

Rationale
=========

TODO: Document why we take the specific approach we do on what the format constrains vs what wallets are expected (required?) to notify users of (once we decide on the approach).


Deployment
==========


Reference implementation
========================


Open issues
===========

Notes from design sessions
==========================

This section should be removed as soon as all the considerations described here
are accounted for in ZIP.

Wallets or consensus-dependent applications that send transactions, might do
something wrong that compromises user funds or privacy if they do not take into
account consensus changes in an upgrade; therefore, only a subset of consensus
changes can be safely adapted to using this mechanism.

In particular, consensus rules may change in such a way that a wallet doing
what it has done in the past causes risk of loss of funds.

An example of this was ZIP 212 [#zip-0212]_. In that case
the existing mechanisms failed to prevent loss of funds because in practice,
wallets updated the consensus branch ID without updating note encryption. We
made the mistake of requiring wallets to change their behaviour for an existing
transaction version. Except for certain cases involving severe security flaws,
we should avoid doing that again.

If a wallet needs to actively do something differently (for example,
advertizing addresses in a new format or creating an output with a TZE
precondition) in order to be affected by a new feature, then it is reasonably
safe for it to ignore the feature as long as it can still parse transactions
and, and create and sign transactions that don't make use of those features.

It is okay that such a wallet might not be able to see funds that depend on new
features, as long as they do not create such funds themselves.

Loss of funds is unacceptable. Temporary inaccessibility of funds in certain
circumstances can be okay -- provided that this potential inaccessiblity and
the circumstances where it can occur is documented and an explicit design
decision.

Strawman
--------

Modify how we approach transaction format evolution, such that (after one more
change to transaction encoding) it is possible for a wallet that has not
adopted a parser for a given transaction format to continue to function after
an *additive* change to the transaction format. Another way to state this is
that we should make it possible to make "semver-compatible" transaction format
changes.

* @str4d: We could use a TLV approach where each "bundle" has a value balance.
  The NSM burn amount field could be its own bundle, the explicit fee data
  could be its own bundle and the consensus rule could be that all value
  balances sum to zero.

  * generically, you want a value balance vector, where you have zero or more
    value balances moving between bundles in other assets.

* @nuttycom: You could have pre-ZSA and post-ZSA Orchard bundles.

Strawman II
-----------

Treat bundles as individually versioned.

* Each bundle is registered with an ID relative to a tx version group ID.
* The bundle ID encoding also has some flag bits indicating how it interacts
  with the tx as a whole.
* Transactions then have two "bundle maps":

  * The first encodes how value moves between the different bundles.
  * The second encodes data specific to a bundle (e.g. how value moves within a bundle)
  * Bundles that don't have any data would just appear in the first map, and
    bundles that don't produce or consume value would just appear in the
    second map.
* We can re-interpret various other facets of transactions as "bundles"

  * Explicit fees are a bundle that never produces value
  * NSM field similarly never produces value
  * ZSA burns would be split into "value balance out of Orchard pool" and
    "value balance being removed from ZSA issuance"
  * See also the conversation we had about refactoring coinbase transactions.
    TODO: Figure out how to integrate the two.
* Privacy effect is minimal

  * We already follow a bundle approach with a transparent transaction value
    pool, for the turnstiles. This leans into it, while preserving the bundle
    boundary within which we implement each privacy protocol.
  * Some combinations of bundles would be permitted by the tx format that
    were not previously permitted.

    * However, we can still restrict which combinations of bundles can be
      mined in the consensus rules.

Sketch of the format:

* Transaction version (like now)

  * Version
  * Version group ID

* Transaction header

  * Expiry height etc
  * Likely need some kind of key-value map here to allow additional fields to
    be added, or maybe version the header to allow evolution?

* Transparent transaction value pool "traffic map"

  * Option 1: BundleVersionID -> (valueBalance, AssetId -> valueBalance)

    * Key: Bundle version ID
    * Value:

      * ZEC `valueBalance`
      * CompactSize len(generalizedValueBalances)
      * Zero or more generalized value balances

        * `AssetId` (not `AssetBase` because those are
          protocol-specific, and we want generalized value balances to
          be understandable independently of protocol changes)
        * `valueBalance`

  * Option 2: (BundleVersionID, Option[AssetId]) -> valueBalance

    * Key: Bundle version ID encoded as u8 || { Option[AssetId] }
    * Value: `valueBalance`

  * Option 3: BundleVersionID -> Option[AssetId] -> valueBalance

    * Key: Bundle version ID
    * Value:

      * Map containing one or more generalized value balances

        * { Option[AssetId] }
        * `valueBalance`
* Sequence of bundles (maybe with a length prefix?)

  * Bundle version ID

    * Maybe flag bits, either in the version ID or next to it, that
      indicate how an opaquely-parsing wallet should interpret the bundle,
      e.g.:

      * A bit that says whether or not the bundle interacts with the
        transparent transaction value pool (which memo bundles would not
        have).

        * Counterpoint: The traffic map already specifies whether a
          given bundle *does* have an interaction with the transparent
          tx value pool for this tx. This is different from whether
          that kind of bundle *can* interact with the transparent tx
          value pool, but it the latter needed?

      * A bit that says whether the bundle has any other effect than what
        is specified in the traffic map.

        * Counterpoint: We should split apart effecting and authorizing
          data in the encoding, and then a bundle must be assumed
          effecting iff it has non-null effecting data.

  * CompactSize len(effectingData)

  * effectingData

  * CompactSize len(authorizingData)

  * authorizingData

    * effectingData and authorizingData would be opaque to the initial
      parser.
    * Parsers that support parsing (tx_version, bundle_version) know how to
      interpret its internals

Questions
---------

* Is it okay for fee calculations to be opaque to wallet parsers, as long as
  the fee amounts can be calculated in consensus?

  * Yes:

    * When receiving, all you care about is knowing the actual fee amount;
      you see that in the fee bundle's value balance.
    * When sending, you need to understand all bundles you are including,
      and then you can calculate the fee.

* Can wallets still compute the txid and wtxid of an arbitrary transaction?

  * Yes, provided that effecting and authorizing data is separated. Then they
    can hash the effecting data even without understanding it to compute the
    txid, and they can hash the authorizing data even without understanding
    it to compute the authorizing data commitment part of the wtxid (ZIP
    239 [#zip-0239]_).
  * *However*, this reintroduces a more direct linkage between the [w]txid
    computation and the transaction encoding. It's arguably fine, and
    potentially simpler -- since the [w]txid computation need not change at
    all for most protocol changes.
  * If the hashing uses flat hashes over the effectingData and
    authorizingData of each bundle (which it has to because the internal
    structure is not known), then it might be more difficult to do Merkle
    proofs over subsets of the data within a bundle. We haven't used that so
    far; is it really needed?


References
==========

.. [#BCP14] `Information on BCP 14 — "RFC 2119: Key words for use in RFCs to Indicate Requirement Levels" and "RFC 8174: Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words <https://www.rfc-editor.org/info/bcp14>`_
.. [#protocol] `Zcash Protocol Specification, Version 2025.6.3 [NU6.1] or later <protocol/protocol.pdf>`_
.. [#protocol-blockchain] `Zcash Protocol Specification, Version 2025.6.3 [NU6.1]. Section 3.3: The Block Chain <protocol/protocol.pdf#blockchain>`_
.. [#protocol-networks] `Zcash Protocol Specification, Version 2025.6.3 [NU6.1]. Section 3.12: Mainnet and Testnet <protocol/protocol.pdf#networks>`_
.. [#zip-0203] `ZIP 203: Transaction Expiry <https://zips.z.cash/zip-0203>`_
.. [#zip-0212] `ZIP 212: Allow Recipient to Derive Ephemeral Secret from Note Plaintext <https://zips.z.cash/zip-0212>`_
.. [#zip-0239] `ZIP 239: Relay of Version 5 Transactions <https://zips.z.cash/zip-0239>`_

