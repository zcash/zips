<!DOCTYPE html>
<html>
<head>
    <title>ZIP 317: Proportional Transfer Fee Mechanism</title>
    <meta charset="utf-8" />
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js?config=TeX-AMS-MML_HTMLorMML"></script>
<meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="css/style.css"></head>
<body>
    <section>
        <pre>ZIP: 317
Title: Proportional Transfer Fee Mechanism
Owners: Aditya Bharadwaj &lt;nighthawk24@gmail.com&gt;
Credits: Madars Virza
         Kris Nuttycombe
         Daira Hopwood
         Jack Grigg
         Francisco Gindre
Status: Draft
Category: Standards / Wallet
Obsoletes: ZIP 313
Created: 2022-08-15
License: MIT
Discussions-To: &lt;<a href="https://forum.zcashcommunity.com/t/zip-proportional-output-fee-mechanism-pofm/42808">https://forum.zcashcommunity.com/t/zip-proportional-output-fee-mechanism-pofm/42808</a>&gt;
Pull-Request: &lt;<a href="https://github.com/zcash/zips/pull/631">https://github.com/zcash/zips/pull/631</a>&gt;</pre>
        <section id="terminology"><h2><span class="section-heading">Terminology</span><span class="section-anchor"> <a rel="bookmark" href="#terminology"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>The key words "SHOULD", "SHOULD NOT", and "RECOMMENDED" in this document are to be interpreted as described in RFC 2119. <a id="footnote-reference-1" class="footnote_reference" href="#rfc2119">1</a></p>
            <p>The term "conventional transaction fee" in this document is in reference to the value of a transaction fee that is conventionally used by wallets, and that a user can reasonably expect miners on the Zcash network to accept for including a transaction in a block.</p>
            <p>The terms "Mainnet, "Testnet", and "zatoshi" in this document are defined as in <a id="footnote-reference-2" class="footnote_reference" href="#protocol-networks">2</a>.</p>
        </section>
        <section id="abstract"><h2><span class="section-heading">Abstract</span><span class="section-anchor"> <a rel="bookmark" href="#abstract"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>The goal of this ZIP is to change the conventional fees for transactions by making them dependent on the number of inputs and outputs in a transaction, and to get buy-in for this change from wallet developers, miners and Zcash users.</p>
        </section>
        <section id="motivation"><h2><span class="section-heading">Motivation</span><span class="section-anchor"> <a rel="bookmark" href="#motivation"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>In light of recent Mainnet network activity, it is time to review and update the standard 1,000 zatoshi transaction fee set in ZIP 313 <a id="footnote-reference-3" class="footnote_reference" href="#zip-0313">5</a>.</p>
            <p>The conventional transaction fee presently is 0.00001 ZEC or 1,000 zatoshis, as specified in ZIP 313. This allowed exploration of novel use cases of the Zcash blockchain. The Zcash network has operated for almost 2 years at a conventional transaction fee of 1,000 zatoshis, without consideration for the total number of inputs and outputs in each transaction. Under this conventional fee, some usage of the chain has been characterized by high-output transactions with 1,100 outputs, paying the same conventional fee as a transaction with 2 outputs.</p>
            <p>The objective of the new fee policy, once it is enforced, is for fees paid by transactions to fairly reflect the processing costs that their inputs and outputs impose on various participants in the network. This will tend to discourage usage patterns that cause either intentional or unintentional denial of service, while still allowing low fees for regular transaction use cases.</p>
        </section>
        <section id="requirements"><h2><span class="section-heading">Requirements</span><span class="section-anchor"> <a rel="bookmark" href="#requirements"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <ul>
                <li>The conventional fee formula should not favour or discriminate against any of the Orchard, Sapling, or transparent protocols.</li>
                <li>The fee for a transaction should scale linearly with the number of inputs and/or outputs.</li>
                <li>Users should not be penalised for sending transactions constructed with padding of inputs and outputs to reduce information leakage. (The default policy employed by zcashd and the mobile SDKs pads to two inputs and two outputs for each shielded pool used by the transaction).</li>
                <li>Users should be able to spend a small number of UTXOs or notes with value below the marginal fee per input.</li>
            </ul>
        </section>
        <section id="specification"><h2><span class="section-heading">Specification</span><span class="section-anchor"> <a rel="bookmark" href="#specification"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <section id="notation"><h3><span class="section-heading">Notation</span><span class="section-anchor"> <a rel="bookmark" href="#notation"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>Let
                    <span class="math">\(\mathsf{max}(a, b)\)</span>
                 be the greater of
                    <span class="math">\(a\)</span>
                 and
                    <span class="math">\(b\)</span>
                . Let
                    <span class="math">\(\mathsf{ceiling}(x)\)</span>
                 be the smallest integer
                    <span class="math">\(\geq x\)</span>
                .</p>
            </section>
            <section id="fee-calculation"><h3><span class="section-heading">Fee calculation</span><span class="section-anchor"> <a rel="bookmark" href="#fee-calculation"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>This specification defines several parameters that are used to calculate the conventional fee:</p>
                <table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Units</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <span class="math">\(marginal\_fee\)</span>
                            </td>
                            <td>zatoshis per logical action (as defined below)</td>
                        </tr>
                        <tr>
                            <td>
                                <span class="math">\(grace\_actions\)</span>
                            </td>
                            <td>logical actions</td>
                        </tr>
                        <tr>
                            <td>
                                <span class="math">\(p2pkh\_standard\_input\_size\)</span>
                            </td>
                            <td>bytes</td>
                        </tr>
                        <tr>
                            <td>
                                <span class="math">\(p2pkh\_standard\_output\_size\)</span>
                            </td>
                            <td>bytes</td>
                        </tr>
                    </tbody>
                </table>
                <p>Wallets implementing this specification SHOULD use a conventional fee calculated in zatoshis per the following formula:</p>
                <div class="math">\(\begin{array}{rcl}
  logical\_actions  &amp;=&amp; \mathsf{max}\big(\mathsf{ceiling}\big(\frac{tx\_in\_total\_size}{p2pkh\_standard\_input\_size}\big),
                                         \mathsf{ceiling}\big(\frac{tx\_out\_total\_size}{p2pkh\_standard\_output\_size}\big)\big) \;+ \\
                    &amp; &amp; 2 \cdot nJoinSplit \;+ \\
                    &amp; &amp; \mathsf{max}(nSpendsSapling, nOutputsSapling) \;+ \\
                    &amp; &amp; nActionsOrchard \\
  conventional\_fee &amp;=&amp; marginal\_fee \cdot \mathsf{max}(grace\_actions, logical\_actions)
\end{array}\)</div>
                <p>The inputs to this formula are taken from transaction fields defined in the Zcash protocol specification <a id="footnote-reference-4" class="footnote_reference" href="#protocol-txnencoding">3</a>:</p>
                <table>
                    <thead>
                        <tr>
                            <th>Input</th>
                            <th>Units</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <span class="math">\(tx\_in\_total\_size\)</span>
                            </td>
                            <td>bytes</td>
                            <td>total size in bytes of the <code>tx_in</code> field</td>
                        </tr>
                        <tr>
                            <td>
                                <span class="math">\(tx\_out\_total\_size\)</span>
                            </td>
                            <td>bytes</td>
                            <td>total size in bytes of the <code>tx_out</code> field</td>
                        </tr>
                        <tr>
                            <td>
                                <span class="math">\(nJoinSplit\)</span>
                            </td>
                            <td>number</td>
                            <td>the number of Sprout JoinSplits</td>
                        </tr>
                        <tr>
                            <td>
                                <span class="math">\(nSpendsSapling\)</span>
                            </td>
                            <td>number</td>
                            <td>the number of Sapling spends</td>
                        </tr>
                        <tr>
                            <td>
                                <span class="math">\(nOutputsSapling\)</span>
                            </td>
                            <td>number</td>
                            <td>the number of Sapling outputs</td>
                        </tr>
                        <tr>
                            <td>
                                <span class="math">\(nActionsOrchard\)</span>
                            </td>
                            <td>number</td>
                            <td>the number of Orchard actions</td>
                        </tr>
                    </tbody>
                </table>
                <p>The parameters are set to the following values:</p>
                <ul>
                    <li>
                        <span class="math">\(marginal\_fee = 5000\)</span>
                    ;</li>
                    <li>
                        <span class="math">\(grace\_actions = 2\)</span>
                    ;</li>
                    <li>
                        <span class="math">\(p2pkh\_standard\_input\_size = 150\)</span>
                     bytes;</li>
                    <li>
                        <span class="math">\(p2pkh\_standard\_output\_size = 34\)</span>
                     bytes.</li>
                </ul>
                <p>It is not a consensus requirement that fees follow this formula; however, wallets SHOULD create transactions that pay this fee, in order to reduce information leakage, unless overridden by the user.</p>
                <section id="rationale-for-logical-actions"><h4><span class="section-heading">Rationale for logical actions</span><span class="section-anchor"> <a rel="bookmark" href="#rationale-for-logical-actions"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h4>
                    <p>The intention is to make the fee paid for a transaction depend on its impact on the network, without discriminating between different protocols (Orchard, Sapling, or transparent). The impact on the network depends on the numbers of inputs and outputs.</p>
                    <p>A previous proposal used
                        <span class="math">\(inputs + outputs\)</span>
                     instead of logical actions. This would have disadvantaged Orchard transactions, as a result of an Orchard Action combining an input and an output. The effect of this combining is that Orchard requires padding of either inputs or outputs to ensure that the number of inputs and outputs are the same. Usage of Sapling and transparent protocols does not require this padding, and so this could have effectively discriminated against Orchard.</p>
                </section>
                <section id="rationale-for-the-chosen-parameters"><h4><span class="section-heading">Rationale for the chosen parameters</span><span class="section-anchor"> <a rel="bookmark" href="#rationale-for-the-chosen-parameters"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h4>
                    <section id="grace-actions"><h5><span class="section-heading">Grace Actions</span><span class="section-anchor"> <a rel="bookmark" href="#grace-actions"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h5>
                        <p><strong>Why not just charge per-action, without a grace window?</strong></p>
                        <ul>
                            <li>This ensures that there is no penalty to padding a 1-action transaction to a 2-action transaction. Such padding is desirable to reduce information leakage from input and output arity, and is the standard approach used by <cite>zcashd</cite> and the mobile SDK transaction builder.</li>
                            <li>Without a grace window, an input with value below the marginal fee would never be worth including in the resulting transaction. With a grace window, an input with value below
                                <span class="math">\(marginal\_fee\)</span>
                             <em>is</em> worth including, if a second input is available that covers both the primary output amount and the conventional transaction fee.</li>
                        </ul>
                        <p><strong>Why a grace window of 2?</strong></p>
                        <p>A 1-in, 2-out (or 2-action) transaction is the smallest possible transaction that permits both an output to a recipient, and a change output. However, as stated above, <cite>zcashd</cite> and the mobile SDK transaction builder will pad the number of inputs to at least 2.</p>
                        <p>Let
                            <span class="math">\(min\_actions\)</span>
                         be the minimum number of logical actions that can be used to execute economically relevant transactions that produce change. Due to the aforementioned padding,
                            <span class="math">\(min\_actions = 2\)</span>
                        .</p>
                        <p>Having a grace window size greater than
                            <span class="math">\(min\_actions\)</span>
                         would increase the cost to create such a minimal transaction. If the cost we believe that users will tolerate for a minimal transaction is
                            <span class="math">\(B\)</span>
                        , then possible choices of
                            <span class="math">\(marginal\_fee\)</span>
                         are bounded above by
                            <span class="math">\(B / \max(min\_actions, grace\_actions)\)</span>
                        . Therefore, the optimal choice of
                            <span class="math">\(grace\_actions\)</span>
                         to maximize the per-logical-action cost of denial-of-service attacks for a given
                            <span class="math">\(B\)</span>
                        , is
                            <span class="math">\(grace\_actions = min\_actions = 2\)</span>
                        . This also ensures that a denial-of-service adversary does not gain a significant per-logical-action cost advantage by using transactions with a smaller or larger number of logical actions.</p>
                    </section>
                    <section id="transparent-contribution"><h5><span class="section-heading">Transparent Contribution</span><span class="section-anchor"> <a rel="bookmark" href="#transparent-contribution"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h5>
                        <p>The specified formula calculates the contribution of transparent inputs and outputs based on their total size relative to a typical input or output. Another considered approach was to calculate this contribution simply as
                            <span class="math">\(\mathsf{max}(transparent\_inputs, transparent\_outputs)\)</span>
                        . However, this would allow a denial-of-service adversary to create transactions with transparent components containing arbitrarily large scripts.</p>
                        <p>The chosen values for
                            <span class="math">\(p2pkh\_standard\_input\_size\)</span>
                         and
                            <span class="math">\(p2pkh\_standard\_output\_size\)</span>
                         are based on the maximum encoded length for P2PKH inputs and outputs, as follows:</p>
                        <ul>
                            <li>
                                <span class="math">\(p2pkh\_standard\_input\_size\)</span>
                                <ul>
                                    <li>outpoint: 36 bytes</li>
                                    <li>script: 110 bytes
                                        <ul>
                                            <li>1 (overall length) + 1 (signature length) + 72 (signature) + 1 (sighash type) + 1 (pubkey length) + 33 (pubkey) + 1 (margin)</li>
                                        </ul>
                                    </li>
                                    <li>sequence: 4 bytes</li>
                                </ul>
                            </li>
                            <li>
                                <span class="math">\(p2pkh\_standard\_output\_size\)</span>
                                <ul>
                                    <li>value: 8 bytes</li>
                                    <li>script: 26 bytes
                                        <ul>
                                            <li>1 (script length) + 25 (P2PKH script)</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <p>P2SH outputs are smaller than P2PKH outputs, but P2SH inputs may be larger than P2PKH inputs. For example a 2-of-3 multisig input is around 70% larger, and is counted as such when computing the number of logical actions.</p>
                    </section>
                    <section id="marginal-fee"><h5><span class="section-heading">Marginal Fee</span><span class="section-anchor"> <a rel="bookmark" href="#marginal-fee"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h5>
                        <p>This returns the conventional fee for a minimal transaction (as described above) to the original conventional fee of 10000 zatoshis specified in <a id="footnote-reference-5" class="footnote_reference" href="#zip-0313">5</a>, and imposes a non-trivial cost for potential denial-of-service attacks.</p>
                    </section>
                </section>
            </section>
            <section id="transaction-relaying"><h3><span class="section-heading">Transaction relaying</span><span class="section-anchor"> <a rel="bookmark" href="#transaction-relaying"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>zcashd, zebrad, and potentially other node implementations, implement fee-based restrictions on relaying of mempool transactions. Nodes that normally relay transactions are expected to do so for transactions that pay at least the conventional fee as specified in this ZIP, unless there are other reasons not to do so for robustness or denial-of-service mitigation.</p>
            </section>
            <section id="mempool-size-limiting"><h3><span class="section-heading">Mempool size limiting</span><span class="section-anchor"> <a rel="bookmark" href="#mempool-size-limiting"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>zcashd and zebrad limit the size of the mempool as described in <a id="footnote-reference-6" class="footnote_reference" href="#zip-0401">6</a>. This specifies a
                    <span class="math">\(low\_fee\_penalty\)</span>
                 that is added to the "eviction weight" if the transaction pays a fee less than the conventional transaction fee. This threshold is modified to use the new conventional fee formula.</p>
            </section>
            <section id="block-production"><h3><span class="section-heading">Block production</span><span class="section-anchor"> <a rel="bookmark" href="#block-production"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>Miners, mining pools, and other block producers, select transactions for inclusion in blocks using a variety of criteria. The algorithm in the following section is planned to be implemented by <cite>zcashd</cite> and <cite>zebrad</cite>.</p>
                <section id="recommended-algorithm-for-block-template-construction"><h4><span class="section-heading">Recommended algorithm for block template construction</span><span class="section-anchor"> <a rel="bookmark" href="#recommended-algorithm-for-block-template-construction"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h4>
                    <p>Define a constant
                        <span class="math">\(weight\_cap = 4\)</span>
                    .</p>
                    <p>Let
                        <span class="math">\(conventional\_fee(tx)\)</span>
                     be the conventional fee for transaction
                        <span class="math">\(tx\)</span>
                     calculated according to the section <a href="#fee-calculation">Fee calculation</a>.</p>
                    <p>The following algorithm is RECOMMENDED for constructing block templates from a set of transactions in a node's mempool:</p>
                    <ol type="1">
                        <li>For each transaction
                            <span class="math">\(tx\)</span>
                         in the mempool, calculate
                            <span class="math">\(tx.\!weight = \mathsf{min}\!\left(\frac{tx.fee}{conventional\_fee(tx)}, weight\_cap\right)\!\)</span>
                        .</li>
                        <li>Repeat while there is any mempool transaction that pays at least the conventional fee and fits in the block:
                            <ol type="a">
                                <li>Pick one of those transactions at random with probability in direct proportion to its weight, and add it to the block.</li>
                            </ol>
                        </li>
                        <li>Let
                            <span class="math">\(N\)</span>
                         be the number of remaining transactions with
                            <span class="math">\(tx.\!weight &lt; 1\!\)</span>
                        . Calculate their sum of weights, call this
                            <span class="math">\(remaining\_weight\!\)</span>
                        .</li>
                        <li>Calculate
                            <span class="math">\(size\_target = size\_of\_block\_so\_far + \mathsf{floor}\!\left(remaining\_block\_size \cdot \mathsf{min}\big(1.0, \frac{remaining\_weight}{N}\big)\!\right)\!\)</span>
                        .</li>
                        <li>Repeat:
                            <ol type="a">
                                <li>Pick a transaction with probability in direct proportion to its weight and add it to the block. If that transaction would exceed the
                                    <span class="math">\(size\_target\!\)</span>
                                , stop without adding it.</li>
                            </ol>
                        </li>
                    </ol>
                    <p>Note: it is sufficient to use floating point arithmetic to calculate the argument to
                        <span class="math">\(\mathsf{floor}\)</span>
                     when computing
                        <span class="math">\(size\_target\!\)</span>
                    , since there is no consensus requirement for this to be exactly the same between implementations.</p>
                </section>
                <section id="rationale-for-block-template-construction-algorithm"><h4><span class="section-heading">Rationale for block template construction algorithm</span><span class="section-anchor"> <a rel="bookmark" href="#rationale-for-block-template-construction-algorithm"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h4>
                    <ul>
                        <li>Regardless of how full the mempool is (according to the ZIP 401 <a id="footnote-reference-7" class="footnote_reference" href="#zip-0401">6</a> cost limiting), a denial-of-service adversary can only fill a block if
                            <span class="math">\(\frac{remaining\_weight}{N}\)</span>
                         is nearly
                            <span class="math">\(1\!\)</span>
                        , i.e. if the remaining transactions are paying nearly the conventional fee on average. This is exactly what we want, because then the selected transactions in step 5 will each tend to be paying nearly the conventional fee. (It's possible that some low-fee transactions will get in, but the adversary can't include too many of them because it would pull the average down.)</li>
                        <li>The weighting in step 2 does not create a situation where the adversary gains a significant advantage over other users by paying more than the conventional fee, for two reasons:
                            <ol type="1">
                                <li>The weight cap limits the relative probability of picking a given transaction to be at most
                                    <span class="math">\(weight\_cap\)</span>
                                 times greater than a transaction that pays exactly the conventional fee.</li>
                                <li>Compare the case where the adversary pays
                                    <span class="math">\(c\)</span>
                                 times the conventional fee for one transaction, to that where they pay the conventional fee for
                                    <span class="math">\(c\)</span>
                                 transactions. In the former case they are more likely to get <em>each</em> transaction into the block relative to competing transactions from other users, <em>but</em> those transactions take up less block space. (The adversary's block space usage relative to fee is optimized by using only Orchard Actions in either case, so they take up
                                    <span class="math">\(c\)</span>
                                 times less space.) This is not what the attacker wants; they get a transaction into the block only at the expense of leaving more block space for the other users' transactions.</li>
                            </ol>
                        </li>
                        <li>The rationale for choosing
                            <span class="math">\(weight\_cap = 4\)</span>
                         is as a compromise between not allowing any prioritization of transactions relative to those that pay the conventional fee, and allowing arbitrary prioritization based on ability to pay.</li>
                    </ul>
                </section>
                <section id="incentive-compatibility-for-miners"><h4><span class="section-heading">Incentive compatibility for miners</span><span class="section-anchor"> <a rel="bookmark" href="#incentive-compatibility-for-miners"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h4>
                    <p>Miners have an incentive to make this change because:</p>
                    <ul>
                        <li>it will tend to increase the fees they are due;</li>
                        <li>fees will act as a damping factor on the time needed to process blocks, and therefore on orphan rate.</li>
                    </ul>
                </section>
            </section>
        </section>
        <section id="security-and-privacy-considerations"><h2><span class="section-heading">Security and Privacy considerations</span><span class="section-anchor"> <a rel="bookmark" href="#security-and-privacy-considerations"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>Non-standard transaction fees may reveal specific users or wallets or wallet versions, which would reduce privacy for those specific users and the rest of the network. However, the advantage of faster deployment weighed against synchronizing the change in wallet behaviour at a specific block height.</p>
            <p>Long term, the issue of fees needs to be revisited in separate future proposals as the blocks start getting consistently full. Wallet developers and operators should monitor the Zcash network for rapid growth in transaction rates, and consider further changes to fee selection and/or other scaling solutions if necessary.</p>
            <section id="denial-of-service"><h3><span class="section-heading">Denial of Service</span><span class="section-anchor"> <a rel="bookmark" href="#denial-of-service"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>A transaction-rate-based denial of service attack occurs when an attacker generates enough transactions over a window of time to prevent legitimate transactions from being mined, or to hinder syncing blocks for full nodes or miners.</p>
                <p>There are two primary protections to this kind of attack in Zcash: the block size limit, and transaction fees. The block size limit ensures that full nodes and miners can keep up with the blockchain even if blocks are completely full. However, users sending legitimate transactions may not have their transactions confirmed in a timely manner.</p>
                <p>This proposal does not alter how fees are paid from transactions to miners.</p>
            </section>
        </section>
        <section id="deployment"><h2><span class="section-heading">Deployment</span><span class="section-anchor"> <a rel="bookmark" href="#deployment"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>Wallets SHOULD deploy these changes immediately. Nodes SHOULD deploy the change to the
                <span class="math">\(low\_fee\_penalty\)</span>
             threshold described in <a href="#mempool-size-limiting">Mempool size limiting</a> immediately.</p>
            <p>Miners can deploy restrictions to their policies for transaction inclusion, once a sufficient proportion of transactions in the ecosystem are observed to be paying at least the updated conventional transaction fee.</p>
            <p>Node developers SHOULD coordinate on schedules for deploying restrictions to their policies for transaction mempool acceptance and peer-to-peer relaying. These policy changes SHOULD NOT be deployed before the changes to transaction inclusion policy by miners described in the preceding paragraph.</p>
        </section>
        <section id="considered-alternatives"><h2><span class="section-heading">Considered Alternatives</span><span class="section-anchor"> <a rel="bookmark" href="#considered-alternatives"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>This section describes alternative proposals that have not been adopted.</p>
            <p>In previous iterations of this specification, the marginal fee was multiplied by the sum of inputs and outputs. This means that the alternatives given below are roughly half of what they would be under the current formula.</p>
            <p>Possible alternatives for the parameters:</p>
            <ul>
                <li>marginal_fee = 250 in @nuttycom's proposal.</li>
                <li>marginal_fee = 1000 adapted from @madars' proposal <a id="footnote-reference-8" class="footnote_reference" href="#madars-1">4</a>.</li>
                <li>marginal_fee = 2500 in @daira's proposal.</li>
                <li>marginal_fee = 1000 for Shielded, Shielding and De-shielding transactions, and marginal_fee = 10000 for Transparent transactions adapted from @nighthawk24's proposal.</li>
            </ul>
            <p>(In @madars' and @nighthawk24's original proposals, there was an additional <cite>base_fee</cite> parameter that caused the relationship between fee and number of inputs/outputs to be non-proportional above the <cite>grace_window_size</cite>. This is no longer expressible with the formula specified above.)</p>
        </section>
        <section id="endorsements"><h2><span class="section-heading">Endorsements</span><span class="section-anchor"> <a rel="bookmark" href="#endorsements"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>The following entities/groups/individuals expressed their support for the updated fee mechanism:</p>
            <p><em>Developer Groups or Sole OSS contributors</em></p>
            <!-- * Zecwallet Suite (Zecwallet Lite for Desktop/iOS/Android &amp; Zecwallet FullNode)
* Nighthawk Wallet for Android &amp; iOS -->
            <p>To express and request your support to be added to this ZIP please comment below indicating:</p>
            <ul>
                <li>(group) name/pseudonym</li>
                <li>affiliation</li>
                <li>contact</li>
            </ul>
            <p>or, conversely e-mail the same details to the Owner of the ZIP.</p>
            <p>TODO: Endorsements may depend on specific parameter choices. The ZIP Editors should ensure that the endorsements are accurate before marking this ZIP as Active.</p>
        </section>
        <section id="acknowledgements"><h2><span class="section-heading">Acknowledgements</span><span class="section-anchor"> <a rel="bookmark" href="#acknowledgements"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>Thanks to Madars Virza for initially proposing a fee mechanism similar to that proposed in this ZIP <a id="footnote-reference-9" class="footnote_reference" href="#madars-1">4</a>, and to Kris Nuttycombe, Jack Grigg, Daira Hopwood, Francisco Gindre, Greg Pfeil, and Teor for suggested improvements.</p>
        </section>
        <section id="references"><h2><span class="section-heading">References</span><span class="section-anchor"> <a rel="bookmark" href="#references"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <table id="rfc2119" class="footnote">
                <tbody>
                    <tr>
                        <th>1</th>
                        <td><a href="https://www.rfc-editor.org/rfc/rfc2119.html">RFC 2119: Key words for use in RFCs to Indicate Requirement Levels</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-networks" class="footnote">
                <tbody>
                    <tr>
                        <th>2</th>
                        <td><a href="protocol/protocol.pdf#networks">Zcash Protocol Specification, Version 2022.3.8. Section 3.12: Mainnet and Testnet</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-txnencoding" class="footnote">
                <tbody>
                    <tr>
                        <th>3</th>
                        <td><a href="protocol/protocol.pdf#txnencoding">Zcash Protocol Specification, Version 2022.3.8. Section 7.1: Transaction Encoding and Consensus</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="madars-1" class="footnote">
                <tbody>
                    <tr>
                        <th>4</th>
                        <td><a href="https://forum.zcashcommunity.com/t/zip-reduce-default-shielded-transaction-fee-to-1000-zats/37566/89">Madars concrete soft-fork proposal</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0313" class="footnote">
                <tbody>
                    <tr>
                        <th>5</th>
                        <td><a href="zip-0313">ZIP 313: Reduce Conventional Transaction Fee to 1000 zatoshis</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0401" class="footnote">
                <tbody>
                    <tr>
                        <th>6</th>
                        <td><a href="zip-0401">ZIP 401: Addressing Mempool Denial-of-Service</a></td>
                    </tr>
                </tbody>
            </table>
        </section>
    </section>
</body>
</html>