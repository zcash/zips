<!DOCTYPE html>
<html>
<head>
    <title>ZIP regular-periodic-turnstiles: Regular Periodic Turnstiles</title>
    <meta charset="utf-8" />
<link rel="stylesheet" href="css/zip-style.css"><link rel="stylesheet" href="assets/css/style.css"></head>
<body>
    <section>
        <pre>ZIP: ???
Title: Regular Periodic Turnstiles
Owner: Nathan Wilcox &lt;nathan@electriccoin.co&gt;
Original-Authors: Nathan Wilcox
Status: Draft
Category: Protocol Design Policy
Created: 2020-01-20
License: MIT</pre>
        <section id="terminology">
            <h2>Terminology</h2>
            <p>The key words "MUST", "MUST NOT", "SHOULD", and "MAY" in this document are to be interpreted as described in RFC 2119. <a refname="rfc2119" href="#id4" class="footnote_reference" id="id1">1</a></p>
            <p>The terms below are to be interpreted as follows:</p>
            <dl>
                <dt>Sprout protocol</dt>
                <dd>Code-name for the Zcash shielded protocol at launch.</dd>
                <dt>Sapling protocol</dt>
                <dd>Code-name for the Zcash shielded protocol added by the second Zcash network upgrade, also known as Network Upgrade 1.</dd>
                <dt>Blossom protocol</dt>
                <dd>Code-name for the Zcash shielded protocol added by the third Zcash network upgrade, also known as Network Upgrade 2.</dd>
            </dl>
        </section>
        <section id="abstract">
            <h2>Abstract</h2>
            <p>This ZIP establishes a protocol design policy to make Zcash <cite>shielded pool turnstiles</cite> a regular process on a predictable schedule. The schedule introduces a new shielded pool once per year, as well as an established <cite>retirement process</cite> for older pools.</p>
        </section>
        <section id="motivation">
            <h2>Motivation</h2>
            <p>…</p>
        </section>
        <section id="requirements">
            <h2>Requirements</h2>
            <section id="transaction-semantics">
                <h3>Transaction Semantics</h3>
                <p>This specification requires the following transaction semantics remain in place in future upgrades. These semantics are already present since the Network Upgrade 1 Sapling upgrade:</p>
                <ol type="1">
                    <li>A transaction's interactions with any given pool are publicly verifiable in the consensus representation. For example, if a transaction involves the Sprout (original) pool and the Sapling NU1 pool, then separate Sprout and Sapling fields are present. Note that if this ZIP is standardized, some pools may have identical field layouts and semantics, and MUST never-the-less be distinguishable in the transaction representation.</li>
                    <li>ZEC may not enter or leave a pool except through an unencrypted, unobfuscated value encoding in the transaction field representing interactions with that pool. Note that this value representation does not require interacting with Transparent addresses, and these semantics can remain in place even should Transparent Addresses be retired from the protocol.</li>
                </ol>
            </section>
            <section id="schedule">
                <h3>Schedule</h3>
                <p>Once per year, during a network upgrade, a new <cite>shielded pool</cite> is established in the consensus protocol. Such network upgrades are referred to as <cite>major network upgrades</cite>. Other upgrades are referred to as <cite>minor network upgrades</cite>.</p>
                <p>These shielded pools are referred to by the major network upgrade that introduces them, as in <cite>shielded pool NU5</cite> would be the shielded pool introduced in <cite>Network Upgrade 5</cite> which implies NU5 is a major upgrade.</p>
                <p>Only a subset of network upgrades, the major upgrades, introduce shielded pools, since more than one network upgrade may occur in one year. Also note that this policy requires <em>at least one</em> network upgrade per year.</p>
            </section>
            <section id="shielded-pool-lifecycles">
                <h3>Shielded Pool Lifecycles</h3>
                <p>Shielded pools are retired through a well-known <cite>retirement process</cite> on a predictable schedule so that they adhere to the following <cite>shielded pool lifecycle</cite> which is a sequence of <cite>stages</cite>. Shielded pools transition to subsequent stages only via the activation of a major network upgrade. At the activation of each major network upgrade, a shielded pool always transitions to the subsequent stage, unless it is in the frozen stage in which it remains permanently.</p>
                <p>The stages are:</p>
                <ol type="1">
                    <li><cite>Current Shielded Pool Stage</cite></li>
                    <li><cite>Previous Shielded Pool Stage</cite></li>
                    <li><cite>Restricted Shielded Pool Stage</cite></li>
                    <li><cite>Retired Shielded Pool Stage</cite></li>
                    <li><cite>Frozen Shielded Pool Stage</cite></li>
                </ol>
                <section id="protocol-lifecycle-states">
                    <h4>Protocol Lifecycle States</h4>
                    <p>Each lifecycle <cite>stage</cite> has an associated <cite>protocol lifecycle state</cite> (or <cite>protocol state</cite> for short) which determines a standard set of consensus rule semantics for interacting with that shielded pool.</p>
                    <ol type="1">
                        <li>Both the <cite>current</cite> and <cite>previous</cite> stages are in the <cite>active protocol state</cite>. In this state the full functionality of the associated pool is available, including transfering funds into the pool from any other active pool or transparent address, transfering funds within the pool, and transfering funds out of the active pool either to a Transparent Address or any other active pool.</li>
                        <li>The <cite>restricted</cite> stage is in the <cite>restricted protocol state</cite>, which prevents any transfers of funds <em>into</em> the pool. Funds may still be transferred out of the pool, and between accounts in the pool. <a href="#id8" id="id9" class="problematic">[#]_</a></li>
                        <li>The <cite>retired</cite> stage is in the <cite>retired protocol state</cite>, which disallows any transfer of funds <em>except</em> out of the pool. This explicitly prohibits transfers of funds between addresses within the pool. <a href="#id8" id="id10" class="problematic">[#]_</a></li>
                        <li>The <cite>frozen</cite> stage is the <cite>frozen protocol state</cite>, in which no transactions may interact with the pool.</li>
                    </ol>
                    <table id="id4" class="footnote">
                        <tbody>
                            <tr>
                                <th>1</th>
                                <td>Implementation note: Because of the transaction semantic requirements, this rule can generally be enforced without circuit changes by merely requiring the transparent funds input to the pool to equal 0.</td>
                            </tr>
                        </tbody>
                    </table>
                    <section id="protocol-states-and-future-compatibility">
                        <h5>Protocol States and Future Compatibility</h5>
                        <p>Zcash is likely to extend shielded functionality in the future in a manner of ways, potentially including even general purpose stateful extensions. If this ZIP is standardized, all such new functionality specifications MUST define appropriate semantics for the four <cite>protocol lifecycle states</cite> above.</p>
                    </section>
                </section>
            </section>
            <section id="user-interface-interactions">
                <h3>User Interface Interactions</h3>
                <p>This ZIP standardizes several user interface requirements:</p>
                <section id="addresses">
                    <h4>Addresses</h4>
                    <p>Some major upgrades will require address format changes, and some will not. It is also possible a future pool may support multiple distinct address types due to different kinds of functionality. Therefore, user interfaces must account for managing funds across multiple pools for a single address.</p>
                </section>
                <section id="migration">
                    <h4>Migration</h4>
                    <p>Because fund amounts must be transparently publicly revealed in transfers between pools by design, this can negatively impact user privacy. User interfaces should provide tools to help users migrate funds between pools as safely as possible.</p>
                    <p>This ZIP requires that user interfaces support the <a href="#zip-0308" id="id5" class="footnote_reference">2</a> migration design from any non-frozen pool to the active pool only. If the <a href="#zip-0308" id="id6" class="footnote_reference">2</a> migration design is superceded, user interfaces MUST adopt the newer migration design upon the next major activation.</p>
                    <aside class="admonition">
                        <h1>TODO</h1>
                        <p>Introduce an improvement ZIP based on <a href="#zip-0308" id="id7" class="footnote_reference">2</a> that is general between pools and thus compatible with this ZIP.</p>
                    </aside>
                </section>
            </section>
        </section>
        <section id="non-requirements">
            <h2>Non-requirements</h2>
            <p>…</p>
        </section>
        <section id="specification">
            <h2>Specification</h2>
            <p>…</p>
            <section id="related-zips">
                <h3>Related ZIPs</h3>
                <p>…</p>
            </section>
            <section id="open-questions">
                <h3>Open questions</h3>
                <p>…</p>
            </section>
        </section>
        <section id="consensus-node-support">
            <h2>Consensus Node Support</h2>
            <p>…</p>
        </section>
        <section id="references">
            <h2>References</h2>
            <table id="zip-0308" class="footnote">
                <tbody>
                    <tr>
                        <th>2</th>
                        <td><a href="zip-0308">ZIP 308: Sprout to Sapling Migration</a></td>
                    </tr>
                </tbody>
            </table>
        </section>
    </section>
    <section class="system-messages">
        <h1>Docutils System Messages</h1>
        <div id="id8">
            <h1>System Message: ERROR/3 (zip-regular-periodic-turnstiles.rst line 80) <a href="#id9">id9</a> <a href="#id10">id10</a></h1>
            <p>Too many autonumbered footnote references: only 1 corresponding footnotes available.</p>
        </div>
    </section>
</body>
</html>